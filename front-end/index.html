<!DOCTYPE html>
<html>
<head>
<title>Task Manager</title>

<style>
body {
    font-family: Arial;
    background: #f4f6f9;
    padding: 40px;
}

.container {
    max-width: 700px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
}

input {
    width: 30%;
    padding: 10px;
    margin: 5px;
}

button {
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
}

.excluir {
    background: #e74c3c;
}

.tarefa {
    background: #fafafa;
    padding: 15px;
    margin-top: 10px;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: white;
    padding: 25px;
    border-radius: 10px;
    width: 300px;
}
</style>
</head>

<body>

<div class="container">

<h1>ðŸ“‹ Gerenciador de Tarefas</h1>

<input id="titulo" placeholder="TÃ­tulo">
<input id="descricao" placeholder="DescriÃ§Ã£o">
<input id="status" placeholder="Status">

<button onclick="criarTarefa()">Criar</button>

<h3>Lista</h3>
<div id="lista"></div>

</div>

<!-- MODAL -->
<div id="modal" class="modal">

    <div class="modal-content">

        <h3>Editar Tarefa</h3>

        <input id="modalTitulo" placeholder="TÃ­tulo">
        <input id="modalDescricao" placeholder="DescriÃ§Ã£o">
        <input id="modalStatus" placeholder="Status">

        <button onclick="salvarModal()">Salvar</button>
        <button onclick="fecharModal()" class="excluir">Cancelar</button>

    </div>

</div>

<script>

const API = "https://task-manager-fullstack-w5up.onrender.com/tarefas"


let tarefaEditando = null

async function carregarTarefas() {

    const res = await fetch(API)
    const tarefas = await res.json()

    const lista = document.getElementById("lista")
    lista.innerHTML = ""

    tarefas.forEach(t => {

        lista.innerHTML += `
            <div class="tarefa">
                <strong>${t.titulo}</strong><br>
                ${t.descricao}<br>
                Status: ${t.status}<br>

                <button onclick="abrirModal(${t.id}, '${t.titulo}', '${t.descricao}', '${t.status}')">
                    Editar
                </button>

                <button class="excluir" onclick="deletarTarefa(${t.id})">
                    Excluir
                </button>
            </div>
        `
    })
}

function abrirModal(id, titulo, descricao, status) {

    tarefaEditando = id

    document.getElementById("modalTitulo").value = titulo
    document.getElementById("modalDescricao").value = descricao
    document.getElementById("modalStatus").value = status

    document.getElementById("modal").style.display = "flex"
}

function fecharModal() {
    document.getElementById("modal").style.display = "none"
}

async function salvarModal() {

    const titulo = document.getElementById("modalTitulo").value
    const descricao = document.getElementById("modalDescricao").value
    const status = document.getElementById("modalStatus").value

    await fetch(`${API}/${tarefaEditando}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ titulo, descricao, status })
    })

    fecharModal()
    carregarTarefas()
}

async function criarTarefa() {

    const titulo = document.getElementById("titulo").value
    const descricao = document.getElementById("descricao").value
    const status = document.getElementById("status").value

    await fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ titulo, descricao, status })
    })

    document.getElementById("titulo").value = ""
    document.getElementById("descricao").value = ""
    document.getElementById("status").value = ""

    carregarTarefas()
}

async function deletarTarefa(id) {

    if (!confirm("Deseja realmente excluir?")) return

    await fetch(`${API}/${id}`, { method: "DELETE" })

    carregarTarefas()
}

carregarTarefas()

</script>
</body>
</html>
